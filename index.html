<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dungeon Fit — Modern Neon UI Demo</title>
  <style>
    /* =========================================================
       MODERN TEEN / GAME UI (BRIGHT + CLEAN)
       ========================================================= */

    :root{
      --bg0:#070814;
      --bg1:#0a0b18;

      --panel: rgba(16, 18, 40, .82);
      --panel2: rgba(18, 20, 52, .70);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.16);

      --text: rgba(250,252,255,.92);
      --muted: rgba(232,238,255,.72);
      --muted2: rgba(232,238,255,.55);

      /* bright teen neon palette */
      --neonA:#7c4dff;   /* purple */
      --neonB:#00e5ff;   /* cyan */
      --neonC:#ff2bd6;   /* hot pink */
      --neonD:#ffcc00;   /* gold */
      --neonE:#00ff9a;   /* green */

      --shadow: 0 26px 90px rgba(0,0,0,.62);
      --shadow2: 0 18px 64px rgba(0,0,0,.52);
      --radius: 18px;
      --radius2: 26px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 14% 10%, rgba(124,77,255,.20), transparent 55%),
        radial-gradient(1100px 760px at 88% 16%, rgba(0,229,255,.16), transparent 55%),
        radial-gradient(900px 720px at 48% 92%, rgba(255,43,214,.10), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
    }

    /* Ambient neon particles */
    .bgFX{position:fixed; inset:0; pointer-events:none; opacity:.9; z-index:0}
    canvas#dust{width:100%;height:100%}

    /* =========================================================
       APP LAYOUT
       ========================================================= */
    .wrap{
      height:100%;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:24px;
      align-items:center;
      justify-content:center;
      padding:24px;
      position:relative;
      z-index:2;
    }

    @media (max-width: 980px){
      body{overflow:auto}
      .wrap{grid-template-columns:1fr; align-items:start; padding:16px}
    }

    /* Side panel collapsible */
    .side{
      height: 820px;
      border-radius: 26px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      box-shadow: var(--shadow);
      padding:14px;
      position:relative;
      overflow:auto;
      transform: translateZ(0);
      transition: .25s transform ease, .25s opacity ease, .25s width ease;
    }
    .side::before{
      content:"";
      position:absolute; inset:-60px;
      background:
        radial-gradient(700px 420px at 18% 8%, rgba(124,77,255,.18), transparent 55%),
        radial-gradient(700px 420px at 86% 18%, rgba(0,229,255,.12), transparent 55%),
        radial-gradient(520px 360px at 60% 98%, rgba(255,43,214,.10), transparent 60%);
      opacity:.95; pointer-events:none;
    }
    .side > *{position:relative}

    .sideHeader{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:8px 10px 10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      margin-bottom:10px;
    }
    .sideHeader h2{
      margin:0;
      font-size:14px;
      letter-spacing:.18px;
    }
    .sideHeader .tiny{
      font-size:11px;
      color:var(--muted2);
      line-height:1.35;
    }

    .sideCollapsed{
      transform: translateX(14px);
      opacity:0;
      width:0;
      padding:0;
      border-color: transparent;
      overflow:hidden;
      pointer-events:none;
    }

    /* "Show Controls" floating button when collapsed */
    .floatingToggle{
      position:fixed;
      top:18px;
      right:18px;
      z-index:50;
      display:none;
    }
    .floatingToggle.show{display:block}

    /* =========================================================
       PHONE SHELL
       ========================================================= */
    .phone{
      width:390px;
      height:820px;
      border-radius: 46px;
      padding:14px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .phone::before{
      content:"";
      position:absolute; inset:-60px;
      background:
        radial-gradient(740px 460px at 50% -10%, rgba(124,77,255,.22), transparent 60%),
        radial-gradient(560px 420px at 92% 15%, rgba(0,229,255,.16), transparent 60%),
        radial-gradient(520px 420px at 18% 90%, rgba(255,43,214,.12), transparent 60%),
        repeating-linear-gradient(60deg, rgba(255,255,255,.08) 0 2px, transparent 2px 12px);
      opacity:.35;
      mix-blend-mode:screen;
      pointer-events:none;
      transform: rotate(8deg);
    }

    .screen{
      height:100%;
      border-radius: 36px;
      background:
        radial-gradient(900px 700px at 50% -10%, rgba(255,255,255,.08), transparent 55%),
        linear-gradient(180deg, rgba(12,14,28,.92), rgba(6,7,12,.95));
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      position:relative;
    }

    .screen::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(800px 600px at 50% 35%, transparent 55%, rgba(0,0,0,.55) 100%);
      pointer-events:none;
      opacity:.55;
    }

    /* =========================================================
       TOPBAR (clean)
       ========================================================= */
    .topbar{
      padding:12px 12px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(0,0,0,.22), transparent);
      position:relative;
      z-index:3;
    }
    .brand{display:flex; align-items:center; gap:10px; min-width:0}
    .logo{
      width:34px;height:34px;border-radius:12px;
      background:
        radial-gradient(16px 16px at 30% 30%, rgba(255,255,255,.42), transparent 60%),
        linear-gradient(135deg, rgba(124,77,255,.95), rgba(0,229,255,.55));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 0 0 1px rgba(255,255,255,.08) inset, 0 18px 40px rgba(124,77,255,.20);
      position:relative; overflow:hidden;
      flex:0 0 auto;
    }
    .logo::after{
      content:"";
      position:absolute; inset:-22px;
      background: repeating-linear-gradient(55deg, rgba(255,255,255,.12) 0 2px, transparent 2px 10px);
      opacity:.18;
      transform: rotate(10deg);
    }
    .brand h1{margin:0; font-size:13px; letter-spacing:.22px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .brand p{margin:0; font-size:11px; color:var(--muted2); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}

    .pillRow{display:flex; gap:8px; align-items:center}
    .pill{
      font-size:11px;
      color:var(--muted);
      padding:8px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      display:flex;
      gap:8px;
      align-items:center;
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
      backdrop-filter: blur(10px);
    }
    .dot{
      width:7px;height:7px;border-radius:99px;
      background:var(--neonE);
      box-shadow: 0 0 0 3px rgba(0,255,154,.14), 0 0 18px rgba(0,255,154,.22);
    }
    .mono{font-family:var(--mono)}

    .btn{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      border-radius: 14px;
      padding:9px 11px;
      font-size:12px;
      cursor:pointer;
      transition:.15s transform ease, .15s background ease, .15s border-color ease, .15s filter ease;
      user-select:none;
    }
    .btn:hover{
      transform:translateY(-1px);
      background:rgba(255,255,255,.09);
      border-color:rgba(255,255,255,.22);
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.30));
    }
    .btn:active{transform:translateY(0); filter:none}

    .btn.primary{
      background: linear-gradient(135deg, rgba(124,77,255,.95), rgba(0,229,255,.50));
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 0 0 1px rgba(255,255,255,.10) inset, 0 22px 50px rgba(124,77,255,.22);
    }
    .btn.pink{
      background: linear-gradient(135deg, rgba(255,43,214,.90), rgba(124,77,255,.55));
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 0 0 1px rgba(255,255,255,.10) inset, 0 22px 50px rgba(255,43,214,.18);
    }
    .btn.ghost{
      background: transparent;
      border-color: rgba(255,255,255,.12);
    }

    /* =========================================================
       CONTENT
       ========================================================= */
    .content{
      padding:12px;
      overflow:auto;
      flex:1 1 auto;
      position:relative;
      z-index:2;
      scroll-behavior:smooth;
    }
    .content::-webkit-scrollbar{width:10px}
    .content::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.14);
      border-radius:999px;
      border:2px solid rgba(0,0,0,.30);
    }

    .sectionTitle{
      display:flex; justify-content:space-between; align-items:flex-end;
      margin:10px 0 10px;
    }
    .sectionTitle h2{margin:0; font-size:13px; letter-spacing:.20px}
    .sectionTitle span{font-size:11px; color:var(--muted2)}

    .grid{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .grid1{display:grid; grid-template-columns:1fr; gap:12px}

    .card{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      padding:12px;
      box-shadow: var(--shadow2);
      position:relative;
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .card::before{
      content:"";
      position:absolute; inset:-60px;
      background:
        radial-gradient(420px 240px at 20% 10%, rgba(124,77,255,.20), transparent 60%),
        radial-gradient(380px 240px at 85% 30%, rgba(0,229,255,.14), transparent 60%),
        radial-gradient(360px 220px at 55% 90%, rgba(255,43,214,.10), transparent 60%);
      opacity:.55;
      pointer-events:none;
    }
    .card > *{position:relative}

    .cardHeader{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px}
    .tag{
      font-size:11px;
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.18);
      color:var(--muted);
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
    }
    .kpi .big{font-size:18px; font-weight:900; letter-spacing:.3px}
    .kpi .sub{font-size:11px; color:var(--muted2)}
    .mini{font-size:12px}
    .muted{color:var(--muted2)}

    .bar{
      height:10px;
      border-radius:999px;
      background:rgba(255,255,255,.09);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
      box-shadow: 0 0 0 1px rgba(0,0,0,.35) inset;
    }
    .bar > i{
      display:block; height:100%;
      width:55%;
      background: linear-gradient(90deg, rgba(124,77,255,.95), rgba(0,229,255,.80), rgba(255,43,214,.55));
      border-radius:999px;
      box-shadow: 0 0 0 1px rgba(255,255,255,.12) inset;
    }

    /* =========================================================
       HERO STATUS (clean)
       ========================================================= */
    .heroRow{display:flex; gap:12px; align-items:center}
    .avatar{
      width:56px; height:56px; border-radius:18px;
      background:
        radial-gradient(20px 20px at 30% 30%, rgba(255,255,255,.40), transparent 60%),
        linear-gradient(135deg, rgba(255,43,214,.22), rgba(124,77,255,.70), rgba(0,229,255,.25));
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset, 0 18px 50px rgba(0,0,0,.45);
      position:relative; overflow:hidden;
      flex:0 0 auto;
    }
    .avatar::after{
      content:"";
      position:absolute; inset:-24px;
      background: repeating-linear-gradient(55deg, rgba(255,255,255,.12) 0 2px, transparent 2px 12px);
      opacity:.20;
      transform: rotate(10deg);
    }
    .levelPill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:11px;
      padding:6px 9px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
    }
    .levelPill b{color:var(--neonB)}
    .heroMeta{font-size:11px; color:var(--muted2); margin-top:6px; line-height:1.35}

    /* =========================================================
       MAP (minimal + clean)
       ========================================================= */
    .map{
      height:230px;
      border-radius: var(--radius2);
      position:relative;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(260px 200px at 20% 30%, rgba(124,77,255,.24), transparent 60%),
        radial-gradient(240px 180px at 70% 25%, rgba(0,229,255,.16), transparent 60%),
        radial-gradient(240px 180px at 65% 85%, rgba(255,43,214,.12), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.60));
      box-shadow: 0 20px 60px rgba(0,0,0,.55);
    }
    .map .gridlines{
      position:absolute; inset:0;
      background:
        linear-gradient(rgba(255,255,255,.07) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,.07) 1px, transparent 1px);
      background-size: 28px 28px;
      opacity:.14;
      mix-blend-mode:screen;
      pointer-events:none;
    }
    .node{
      position:absolute;
      width:46px;height:46px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      backdrop-filter: blur(10px);
      display:grid;
      place-items:center;
      cursor:pointer;
      transition:.18s transform ease, .18s background ease, .18s border-color ease, .18s filter ease;
      user-select:none;
    }
    .node:hover{
      transform:translateY(-2px) scale(1.02);
      background:rgba(255,255,255,.12);
      border-color:rgba(255,255,255,.26);
      filter: drop-shadow(0 14px 18px rgba(0,0,0,.40));
    }
    .node .n{font-weight:900; font-size:12px; letter-spacing:.2px}
    .node.raid{background: rgba(255,204,0,.12); border-color: rgba(255,204,0,.30)}
    .node.safe{background: rgba(0,255,154,.10); border-color: rgba(0,255,154,.28)}
    .node.boss{background: rgba(255,43,214,.12); border-color: rgba(255,43,214,.30)}
    .node.locked{opacity:.55; filter: grayscale(.2)}
    .path{position:absolute; inset:0; pointer-events:none; opacity:.58}

    /* =========================================================
       EXERCISE THUMBS (clean)
       ========================================================= */
    .exRow{display:flex; gap:10px; align-items:center}
    .exImg{
      width:44px;height:44px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.07);
      display:grid;
      place-items:center;
      overflow:hidden;
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
      flex:0 0 auto;
    }
    .exImg svg{width:42px;height:42px; opacity:.95; filter: drop-shadow(0 12px 18px rgba(0,0,0,.28));}
    .exName{font-weight:900; letter-spacing:.2px; font-size:12px}
    .exMeta{font-size:11px; color:var(--muted2); margin-top:2px}
    .exBtnRow{display:flex; gap:10px; margin-top:10px}
    .exBtnRow .btn{flex:1}

    /* =========================================================
       BOTTOM NAV (simple icons + glow active)
       ========================================================= */
    .nav{
      border-top:1px solid rgba(255,255,255,.08);
      padding:10px;
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:8px;
      background: linear-gradient(0deg, rgba(0,0,0,.40), transparent);
      position:relative;
      z-index:3;
    }
    .nav button{
      border:none;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      color:var(--muted);
      padding:10px 8px;
      border-radius: 16px;
      cursor:pointer;
      font-size:11px;
      display:flex;
      flex-direction:column;
      gap:5px;
      align-items:center;
      justify-content:center;
      transition:.15s transform ease, .15s background ease, .15s border-color ease, .15s filter ease;
      user-select:none;
    }
    .nav button:hover{
      transform:translateY(-1px);
      background:rgba(255,255,255,.08);
      border-color:rgba(255,255,255,.16);
      filter: drop-shadow(0 12px 18px rgba(0,0,0,.32));
    }
    .nav button.active{
      background: linear-gradient(135deg, rgba(124,77,255,.40), rgba(0,229,255,.16));
      color:var(--text);
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 0 0 1px rgba(255,255,255,.08) inset, 0 0 18px rgba(0,229,255,.16);
    }
    .ico{
      width:18px;height:18px;border-radius:7px;
      background: linear-gradient(135deg, rgba(255,255,255,.14), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.10);
      position:relative; overflow:hidden;
    }
    .ico::after{
      content:"";
      position:absolute; inset:-8px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.32), transparent 60%);
      opacity:.8;
    }

    /* =========================================================
       VIEWS
       ========================================================= */
    .view{display:none; animation: fadeIn .18s ease}
    .view.active{display:block}
    @keyframes fadeIn{
      from{opacity:0; transform: translateY(6px)}
      to{opacity:1; transform: translateY(0)}
    }

    /* =========================================================
       MODALS
       ========================================================= */
    .backdrop{
      position:absolute;
      inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:14px;
      z-index:10;
    }
    .backdrop.show{display:flex}
    .modal{
      width:100%;
      border-radius:22px;
      background: rgba(12,14,28,.96);
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 26px 90px rgba(0,0,0,.72);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .modalHead{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(0,0,0,.16), transparent);
    }
    .modalHead b{font-size:13px; letter-spacing:.18px}
    .modalBody{padding:12px}

    /* =========================================================
       SUMMON: HORIZONTAL "ROLL" REEL (left-to-right)
       ========================================================= */
    .summonGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .banner{
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(135deg, rgba(124,77,255,.22), rgba(0,0,0,.18));
      overflow:hidden;
      position:relative;
      padding:12px;
      box-shadow: 0 18px 56px rgba(0,0,0,.55);
      cursor:pointer;
      user-select:none;
      transition:.18s transform ease, .18s filter ease, .18s border-color ease;
    }
    .banner:hover{transform: translateY(-2px); filter: drop-shadow(0 18px 22px rgba(0,0,0,.40)); border-color: rgba(255,255,255,.18)}
    .banner:active{transform: translateY(0)}
    .banner.sel{
      border-color: rgba(0,229,255,.28);
      box-shadow: 0 0 0 1px rgba(0,229,255,.14) inset, 0 20px 56px rgba(0,0,0,.55), 0 0 18px rgba(0,229,255,.12);
    }
    .banner::before{
      content:"";
      position:absolute; inset:-60px;
      background:
        radial-gradient(420px 240px at 30% 20%, rgba(0,229,255,.22), transparent 60%),
        radial-gradient(380px 240px at 85% 70%, rgba(255,43,214,.16), transparent 60%),
        repeating-linear-gradient(55deg, rgba(255,255,255,.10) 0 2px, transparent 2px 14px);
      opacity:.26;
      transform: rotate(8deg);
      pointer-events:none;
    }
    .banner > *{position:relative}
    .bannerTitle{font-weight:950; letter-spacing:.2px; font-size:12px}
    .bannerDesc{font-size:11px; color:var(--muted2); margin-top:4px; line-height:1.35}
    .bannerFoot{display:flex; justify-content:space-between; align-items:center; margin-top:10px}
    .rarRow{display:flex; gap:6px; align-items:center}
    .rarDot{width:7px;height:7px;border-radius:99px;background:var(--neonD); box-shadow: 0 0 14px rgba(255,204,0,.22)}
    .rarDot.epic{background:var(--neonA); box-shadow: 0 0 14px rgba(124,77,255,.30)}
    .rarDot.rare{background:var(--neonB); box-shadow: 0 0 14px rgba(0,229,255,.25)}
    .rarDot.common{background:rgba(255,255,255,.55); box-shadow:none}
    .rarLabel{font-size:11px;color:var(--muted)}

    .summonStage{
      width:100%;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background:
        radial-gradient(420px 260px at 50% 30%, rgba(124,77,255,.18), transparent 70%),
        radial-gradient(420px 260px at 60% 70%, rgba(0,229,255,.12), transparent 70%),
        linear-gradient(180deg, rgba(0,0,0,.18), rgba(0,0,0,.58));
      position:relative;
      overflow:hidden;
      margin-top:10px;
      box-shadow: 0 18px 62px rgba(0,0,0,.62);
    }
    .summonPrompt{
      position:absolute;
      left:12px; right:12px; top:12px;
      display:flex; justify-content:space-between; align-items:flex-start; gap:10px;
      z-index:2;
    }
    .summonBtnBar{
      position:absolute;
      left:12px; right:12px; bottom:12px;
      display:flex; gap:10px;
      z-index:2;
    }
    .summonBtnBar .btn{flex:1}

    /* Reel viewport */
    .reelWrap{
      position:relative;
      height: 220px;
      padding: 52px 12px 56px;
      z-index:1;
    }
    .reelViewport{
      height: 112px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      overflow:hidden;
      position:relative;
      box-shadow: 0 0 0 1px rgba(0,0,0,.35) inset;
    }
    .reelViewport::before{
      content:"";
      position:absolute; inset:-80px;
      background:
        radial-gradient(420px 240px at 35% 30%, rgba(0,229,255,.16), transparent 60%),
        radial-gradient(420px 240px at 70% 70%, rgba(255,43,214,.12), transparent 60%),
        repeating-linear-gradient(55deg, rgba(255,255,255,.10) 0 2px, transparent 2px 16px);
      opacity:.20;
      transform: rotate(8deg);
      pointer-events:none;
    }
    /* center selection indicator */
    .reelIndicator{
      position:absolute;
      left:50%;
      top:0;
      transform: translateX(-50%);
      width: 0;
      height: 100%;
      z-index:3;
      pointer-events:none;
    }
    .reelIndicator::before{
      content:"";
      position:absolute;
      top:0; bottom:0;
      width:2px;
      left:-1px;
      background: rgba(255,255,255,.55);
      box-shadow: 0 0 18px rgba(0,229,255,.22);
      opacity:.85;
    }
    .reelIndicator::after{
      content:"";
      position:absolute;
      top:50%;
      transform: translate(-50%,-50%);
      width: 44px; height: 44px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.18);
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.24), rgba(255,255,255,.06));
      box-shadow: 0 0 0 1px rgba(0,0,0,.35) inset, 0 0 24px rgba(0,229,255,.16);
      opacity:.45;
      left:0;
    }

    .reel{
      height: 100%;
      display:flex;
      gap:10px;
      align-items:center;
      padding:12px;
      position:relative;
      will-change: transform;
    }

    .reelItem{
      min-width: 160px;
      height: 76px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 10px;
      gap:10px;
      box-shadow: 0 0 0 1px rgba(0,0,0,.35) inset;
    }
    .reelLeft{display:flex; gap:10px; align-items:center; min-width:0}
    .reelIcon{
      width:42px;height:42px;border-radius:16px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
      position:relative; overflow:hidden; flex:0 0 auto;
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
    }
    .reelIcon::after{
      content:"";
      position:absolute; inset:-14px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.30), transparent 60%);
      opacity:.9;
    }
    .reelName{
      font-weight:950;
      letter-spacing:.15px;
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 86px;
    }
    .reelType{
      font-size:11px;
      color:var(--muted2);
      margin-top:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 86px;
    }
    .reelRarity{
      font-size:11px;
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.86);
      flex:0 0 auto;
    }
    .rar-common{border-color: rgba(255,255,255,.14)}
    .rar-rare{border-color: rgba(0,229,255,.28); box-shadow: 0 0 14px rgba(0,229,255,.14)}
    .rar-epic{border-color: rgba(124,77,255,.32); box-shadow: 0 0 14px rgba(124,77,255,.16)}
    .rar-legendary{border-color: rgba(255,204,0,.34); box-shadow: 0 0 14px rgba(255,204,0,.14)}

    /* Result card */
    .summonResult{
      margin-top:10px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      padding:12px;
      display:none;
      box-shadow: var(--shadow2);
    }
    .summonResult.show{display:block}
    .resultName{font-weight:950; letter-spacing:.2px}
    .resultMeta{font-size:11px; color:var(--muted2); margin-top:4px; line-height:1.4}
    .resultBadgeRow{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}

    /* =========================================================
       LEADERBOARD
       ========================================================= */
    .leaderTabs{
      display:flex; gap:8px; align-items:center;
      padding:8px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
    }
    .chipBtn{
      flex:1;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size:11px;
      cursor:pointer;
      transition: .15s transform ease, .15s border-color ease, .15s background ease, .15s filter ease;
      user-select:none;
      text-align:center;
    }
    .chipBtn:hover{transform: translateY(-1px); background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.18); filter: drop-shadow(0 12px 18px rgba(0,0,0,.26))}
    .chipBtn.active{
      color: var(--text);
      background: linear-gradient(135deg, rgba(255,43,214,.28), rgba(0,229,255,.14));
      border-color: rgba(255,255,255,.18);
      box-shadow: 0 0 0 1px rgba(255,255,255,.08) inset, 0 0 18px rgba(255,43,214,.10);
    }

    .lbList{display:grid; gap:10px}
    .lbRow{
      display:grid;
      grid-template-columns: 28px 1fr auto;
      gap:10px;
      align-items:center;
      padding:10px 10px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      box-shadow: 0 0 0 1px rgba(0,0,0,.28) inset;
      overflow:hidden;
      position:relative;
    }
    .lbRow::before{
      content:"";
      position:absolute; inset:-80px;
      background: radial-gradient(420px 240px at 20% 10%, rgba(0,229,255,.12), transparent 60%),
                  radial-gradient(420px 240px at 85% 70%, rgba(255,43,214,.10), transparent 60%);
      opacity:.20;
      pointer-events:none;
    }
    .lbRow > *{position:relative}

    .rankNum{
      font-family:var(--mono);
      font-weight:900;
      color: rgba(255,255,255,.90);
      text-align:center;
    }
    .lbUser{display:flex; gap:10px; align-items:center; min-width:0}
    .pfp{
      width:38px; height:38px; border-radius: 16px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(124,77,255,.40), rgba(0,229,255,.18));
      box-shadow: 0 0 0 1px rgba(0,0,0,.28) inset;
      position:relative; overflow:hidden; flex:0 0 auto;
    }
    .pfp::after{
      content:"";
      position:absolute; inset:-14px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.32), transparent 60%);
      opacity:.9;
    }
    .lbName{
      font-weight:950;
      letter-spacing:.15px;
      font-size:12px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .lbSub{
      font-size:11px;
      color:var(--muted2);
      margin-top:2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .lbScore{
      text-align:right;
      font-family:var(--mono);
      font-weight:900;
      font-size:12px;
    }
    .lbGlowTop1{border-color: rgba(255,204,0,.24); box-shadow: 0 0 0 1px rgba(255,204,0,.10) inset, 0 0 18px rgba(255,204,0,.10)}
    .lbGlowTop2{border-color: rgba(0,229,255,.20); box-shadow: 0 0 0 1px rgba(0,229,255,.10) inset, 0 0 18px rgba(0,229,255,.10)}
    .lbGlowTop3{border-color: rgba(255,43,214,.18); box-shadow: 0 0 0 1px rgba(255,43,214,.10) inset, 0 0 18px rgba(255,43,214,.10)}

    /* =========================================================
       TRACKER FORM
       ========================================================= */
    .form{display:grid; gap:10px}
    .field{display:grid; gap:6px}
    .label{font-size:11px; color:var(--muted); letter-spacing:.18px}
    input, select, textarea{
      width:100%;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
      color:var(--text);
      outline:none;
      box-shadow: 0 0 0 1px rgba(0,0,0,.28) inset;
      transition:.15s border-color ease, .15s background ease, .15s box-shadow ease;
      font-family: var(--sans);
    }
    textarea{min-height:70px; resize:none}
    input:focus, select:focus, textarea:focus{
      border-color: rgba(0,229,255,.28);
      background: rgba(0,0,0,.18);
      box-shadow: 0 0 0 1px rgba(0,229,255,.14) inset, 0 0 18px rgba(0,229,255,.10);
    }
    .two{display:grid; grid-template-columns: 1fr 1fr; gap:10px}

    .history{margin-top:10px; display:grid; gap:10px}
    .entry{
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.14);
      padding:10px;
      position:relative;
      overflow:hidden;
      box-shadow: 0 0 0 1px rgba(0,0,0,.30) inset;
    }
    .entry::before{
      content:"";
      position:absolute; inset:-80px;
      background: radial-gradient(420px 240px at 22% 12%, rgba(124,77,255,.14), transparent 60%),
                  radial-gradient(420px 240px at 86% 72%, rgba(0,229,255,.10), transparent 60%);
      opacity:.35;
      pointer-events:none;
    }
    .entry > *{position:relative}
    .entryTop{display:flex; justify-content:space-between; gap:10px}
    .entryTitle{font-weight:950; letter-spacing:.15px; font-size:12px}
    .entryMeta{font-size:11px; color:var(--muted2); margin-top:3px; line-height:1.4}
    .entryActions{display:flex; gap:8px; align-items:flex-start}
    .tinyBtn{
      font-size:11px;
      padding:7px 9px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      cursor:pointer;
      user-select:none;
      transition:.15s transform ease, .15s border-color ease, .15s background ease;
    }
    .tinyBtn:hover{transform: translateY(-1px); border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.09)}
    .tinyBtn.danger{border-color: rgba(255,43,214,.22); color: rgba(255,205,245,.92)}
    .tinyBtn.danger:hover{background: rgba(255,43,214,.10)}

    /* =========================================================
       TOAST
       ========================================================= */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      width:min(520px, 92vw);
      padding:12px 14px;
      border-radius:16px;
      background: rgba(12,14,28,.92);
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 22px 70px rgba(0,0,0,.68);
      color: rgba(255,255,255,.92);
      font-size:12px;
      white-space:pre-line;
      backdrop-filter: blur(10px);
      z-index:999;
      opacity:0;
      pointer-events:none;
      transition: .15s opacity ease;
    }

    /* =========================================================
       SMALL UTIL
       ========================================================= */
    .btnRow{display:flex; gap:10px; margin-top:10px}
    .btnRow .btn{flex:1}

    .hide{display:none!important}
  </style>
</head>

<body>
  <div class="bgFX" aria-hidden="true"><canvas id="dust"></canvas></div>

  <!-- Floating controls toggle (appears when controls are hidden) -->
  <button class="btn primary floatingToggle" id="showControlsBtn">Show Controls</button>

  <div class="wrap">
    <!-- PHONE -->
    <div class="phone" aria-label="Dungeon Fit demo phone">
      <div class="screen">
        <div class="topbar">
          <div class="brand">
            <div class="logo"></div>
            <div style="min-width:0">
              <h1>Dungeon Fit</h1>
              <p>Neon UI • Demo</p>
            </div>
          </div>
          <div class="pillRow">
            <div class="pill" title="Streak">
              <span class="dot"></span>
              <span><span class="mono" id="streak">6</span> streak</span>
            </div>
            <button class="btn pink" id="openSummon">Summon</button>
          </div>
        </div>

        <div class="content" id="content">
          <!-- VIEW: MAP -->
          <section class="view active" id="view-map">
            <div class="card">
              <div class="cardHeader">
                <div class="heroRow">
                  <div class="avatar"></div>
                  <div>
                    <div class="levelPill">Hunter <b>LVL <span id="lvl">12</span></b></div>
                    <div class="heroMeta">
                      <span class="mono">HP</span> <span id="hp">86</span>/100 •
                      <span class="mono">STA</span> <span id="sta">42</span>/60 •
                      Rank: <b id="rank">Silver</b>
                    </div>
                  </div>
                </div>
                <span class="tag">Today: <span class="mono" id="mins">34</span> min</span>
              </div>
              <div class="bar"><i id="dailyBar"></i></div>
              <div class="mini muted" style="display:flex;justify-content:space-between;margin-top:10px">
                <span>Goal: 60 min • Unlock boss gate</span>
                <span class="mono"><span id="goalPct">57</span>%</span>
              </div>
            </div>

            <div class="sectionTitle">
              <h2>Gate Map</h2>
              <span>Tap a gate</span>
            </div>

            <div class="map" id="map">
              <svg class="path" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path d="M12,70 C20,55 30,52 40,40 C50,28 62,30 72,20 C80,12 90,16 94,30"
                      fill="none" stroke="rgba(255,255,255,.22)" stroke-width="1.5" />
                <path d="M12,70 C24,82 35,86 45,78 C55,70 60,64 70,62 C80,60 88,66 94,76"
                      fill="none" stroke="rgba(255,255,255,.14)" stroke-width="1.3" />
              </svg>
              <div class="gridlines"></div>

              <button class="node safe" style="left:10%; top:62%"
                data-node="Warm-up Cavern" data-diff="Easy"
                data-req="8 min • Stretch + Walk" data-reward="+120 XP • +1 Token"><span class="n">1</span></button>

              <button class="node" style="left:34%; top:44%"
                data-node="Stride Ruins" data-diff="Medium"
                data-req="15 min • Walk/Run" data-reward="+260 XP • +2 Tokens"><span class="n">2</span></button>

              <button class="node raid" style="left:62%; top:26%"
                data-node="Squad Gate" data-diff="Raid"
                data-req="Team • 25 min combined" data-reward="+420 XP • +4 Tokens"><span class="n">R</span></button>

              <button class="node boss locked" style="left:84%; top:18%"
                data-node="Boss Gate: Wyrm of Idleness" data-diff="Boss"
                data-req="Requires: 60 min today" data-reward="Legendary Drop • Title"><span class="n">B</span></button>

              <button class="node" style="left:78%; top:70%"
                data-node="HIIT Rift" data-diff="Hard"
                data-req="10 rounds • HIIT" data-reward="+320 XP • +3 Tokens"><span class="n">H</span></button>

              <button class="node safe" style="left:18%; top:78%"
                data-node="Stretch Shrine" data-diff="Easy"
                data-req="6 min • Mobility" data-reward="+90 XP • +1 Token"><span class="n">S</span></button>
            </div>

            <div class="sectionTitle" style="margin-top:14px">
              <h2>Quick Quests</h2>
              <span>Fast rewards</span>
            </div>

            <div class="grid">
              <div class="card">
                <div class="cardHeader">
                  <div class="kpi">
                    <div class="big mono" id="steps">5,240</div>
                    <div class="sub">Steps</div>
                  </div>
                  <span class="tag">+2 Tokens</span>
                </div>
                <div class="mini muted">Quest: Reach 6,000 steps</div>
                <div class="bar" style="margin-top:10px"><i id="barSteps" style="width:87%"></i></div>
              </div>

              <div class="card">
                <div class="cardHeader">
                  <div class="kpi">
                    <div class="big mono" id="squatsDone">32</div>
                    <div class="sub">Squats</div>
                  </div>
                  <span class="tag">+120 XP</span>
                </div>
                <div class="mini muted">Quest: 50 squats (any sets)</div>
                <div class="bar" style="margin-top:10px"><i id="barSquats" style="width:64%"></i></div>
              </div>
            </div>
          </section>

          <!-- VIEW: TRAIN -->
          <section class="view" id="view-train">
            <div class="sectionTitle">
              <h2>Training</h2>
              <span>Log it → earn rewards</span>
            </div>

            <div class="card">
              <div class="cardHeader">
                <div>
                  <b style="letter-spacing:.15px">Exercise Library</b>
                  <div class="mini muted">Quick presets + record</div>
                </div>
                <span class="tag">No equipment</span>
              </div>

              <div class="grid">
                <div class="card" style="padding:10px">
                  <div class="exRow">
                    <div class="exImg" id="img-pushup"></div>
                    <div>
                      <div class="exName">Push-ups</div>
                      <div class="exMeta">Strength • Chest/Arms</div>
                    </div>
                  </div>
                  <div class="exBtnRow">
                    <button class="btn" onclick="preset('Push-ups','reps',20)">Preset</button>
                    <button class="btn primary" onclick="openRecord('Push-ups')">Record</button>
                  </div>
                </div>

                <div class="card" style="padding:10px">
                  <div class="exRow">
                    <div class="exImg" id="img-squat"></div>
                    <div>
                      <div class="exName">Squats</div>
                      <div class="exMeta">Strength • Legs</div>
                    </div>
                  </div>
                  <div class="exBtnRow">
                    <button class="btn" onclick="preset('Squats','reps',30)">Preset</button>
                    <button class="btn primary" onclick="openRecord('Squats')">Record</button>
                  </div>
                </div>

                <div class="card" style="padding:10px">
                  <div class="exRow">
                    <div class="exImg" id="img-run"></div>
                    <div>
                      <div class="exName">Run/Walk</div>
                      <div class="exMeta">Cardio • Endurance</div>
                    </div>
                  </div>
                  <div class="exBtnRow">
                    <button class="btn" onclick="preset('Run/Walk','minutes',20)">Preset</button>
                    <button class="btn primary" onclick="openRecord('Run/Walk')">Record</button>
                  </div>
                </div>

                <div class="card" style="padding:10px">
                  <div class="exRow">
                    <div class="exImg" id="img-plank"></div>
                    <div>
                      <div class="exName">Plank</div>
                      <div class="exMeta">Core • Stability</div>
                    </div>
                  </div>
                  <div class="exBtnRow">
                    <button class="btn" onclick="preset('Plank','seconds',45)">Preset</button>
                    <button class="btn primary" onclick="openRecord('Plank')">Record</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="sectionTitle" style="margin-top:14px">
              <h2>Workout Log</h2>
              <span>Saved locally</span>
            </div>

            <div class="card">
              <div class="cardHeader">
                <div>
                  <b>Today’s Summary</b>
                  <div class="mini muted">From your recorded entries</div>
                </div>
                <span class="tag">XP + Tokens</span>
              </div>

              <div class="grid">
                <div class="card" style="padding:10px">
                  <div class="mini muted"><b style="color:rgba(255,255,255,.92)">Minutes</b></div>
                  <div class="kpi" style="margin-top:8px">
                    <div class="big mono" id="sumMinutes">34</div>
                    <div class="sub">min active</div>
                  </div>
                  <div class="mini muted" style="margin-top:8px;line-height:1.45">
                    More minutes boosts END + unlocks boss gates.
                  </div>
                </div>

                <div class="card" style="padding:10px">
                  <div class="mini muted"><b style="color:rgba(255,255,255,.92)">Reps</b></div>
                  <div class="kpi" style="margin-top:8px">
                    <div class="big mono" id="sumReps">62</div>
                    <div class="sub">total reps</div>
                  </div>
                  <div class="mini muted" style="margin-top:8px;line-height:1.45">
                    Reps strengthen STR + improve loot odds.
                  </div>
                </div>
              </div>

              <div class="history" id="history"></div>

              <div class="btnRow">
                <button class="btn" onclick="exportLog()">Export JSON</button>
                <button class="btn" style="border-color:rgba(255,43,214,.22);color:rgba(255,205,245,.92)" onclick="clearLog()">Clear</button>
              </div>
            </div>
          </section>

          <!-- VIEW: BUILD -->
          <section class="view" id="view-build">
            <div class="sectionTitle">
              <h2>Build</h2>
              <span>Stats • Skills • Gear</span>
            </div>

            <div class="card">
              <div class="cardHeader">
                <div class="heroRow">
                  <div class="avatar"></div>
                  <div>
                    <div style="font-weight:950; letter-spacing:.15px">Shadow Runner</div>
                    <div class="mini muted">Class: Agile • Title: Gatebreaker</div>
                    <div class="heroMeta">
                      XP: <span class="mono" id="xpNow">2,840</span> / <span class="mono" id="xpNext">3,200</span>
                      • Next: <b>LVL <span id="lvlNext">13</span></b>
                    </div>
                  </div>
                </div>
                <button class="btn" onclick="toast('Customize (demo).')">Customize</button>
              </div>

              <div class="grid">
                <div class="card" style="padding:10px">
                  <div class="mini muted"><b style="color:rgba(255,255,255,.92)">Stats</b></div>
                  <div class="mini muted" style="margin-top:8px; line-height:1.65">
                    STR: <span class="mono" id="statSTR">14</span><br/>
                    AGI: <span class="mono" id="statAGI">19</span><br/>
                    END: <span class="mono" id="statEND">16</span><br/>
                    LCK: <span class="mono" id="statLCK">8</span>
                  </div>
                </div>
                <div class="card" style="padding:10px">
                  <div class="mini muted"><b style="color:rgba(255,255,255,.92)">Skill Tree</b></div>
                  <div class="mini muted" style="margin-top:8px; line-height:1.5">
                    • Sprint Burst — unlocked<br/>
                    • Iron Core — unlocked<br/>
                    • Shadow Step — locked (45 min day)<br/>
                    • Boss Breaker — locked (80 squats)
                  </div>
                </div>
              </div>

              <div class="sectionTitle" style="margin-top:12px">
                <h2>Gear</h2>
                <span>Cosmetics + bonuses</span>
              </div>

              <div class="grid">
                <div class="card" style="padding:10px">
                  <div class="mini muted"><b style="color:rgba(255,255,255,.92)">Night Runner Cloak</b></div>
                  <div class="mini muted" style="margin-top:6px">Bonus: <span class="mono">+5% XP</span></div>
                  <div class="mini muted" style="margin-top:6px">Source: Streak chest</div>
                </div>
                <div class="card" style="padding:10px">
                  <div class="mini muted"><b style="color:rgba(255,255,255,.92)">Silver Wristband</b></div>
                  <div class="mini muted" style="margin-top:6px">Bonus: <span class="mono">+1 Token/day</span></div>
                  <div class="mini muted" style="margin-top:6px">Source: Squad Gate</div>
                </div>
              </div>
            </div>
          </section>

          <!-- VIEW: LEADERBOARD (NEW) -->
          <section class="view" id="view-leaderboard">
            <div class="sectionTitle">
              <h2>Leaderboard</h2>
              <span>Compete with friends</span>
            </div>

            <div class="card">
              <div class="cardHeader">
                <div>
                  <b>Top Hunters</b>
                  <div class="mini muted">Updates as you log workouts (demo)</div>
                </div>
                <span class="tag">Weekly</span>
              </div>

              <div class="leaderTabs">
                <button class="chipBtn active" id="tabSteps">Steps</button>
                <button class="chipBtn" id="tabMinutes">Minutes</button>
                <button class="chipBtn" id="tabStreak">Streak</button>
              </div>

              <div style="height:10px"></div>

              <div class="lbList" id="lbList"></div>

              <div class="btnRow">
                <button class="btn" onclick="toast('Invite friends (demo).')">Invite</button>
                <button class="btn primary" onclick="toast('Challenge sent (demo).')">Challenge</button>
              </div>
            </div>
          </section>

          <!-- VIEW: VAULT -->
          <section class="view" id="view-vault">
            <div class="sectionTitle">
              <h2>Vault</h2>
              <span>Tokens • Badges</span>
            </div>

            <div class="grid">
              <div class="card">
                <div class="cardHeader">
                  <div>
                    <b>Tokens</b>
                    <div class="mini muted">Earned by training</div>
                  </div>
                  <span class="tag"><span class="mono" id="tokens">14</span> owned</span>
                </div>
                <div class="mini muted" style="line-height:1.5">
                  Spend tokens in the summon banner for skills + cosmetics.
                </div>
                <div class="btnRow">
                  <button class="btn pink" onclick="openSummon()">Summon</button>
                  <button class="btn" onclick="toast('Chests (demo).')">Chests</button>
                </div>
              </div>

              <div class="card">
                <div class="cardHeader">
                  <div>
                    <b>Badges</b>
                    <div class="mini muted">Proof of progress</div>
                  </div>
                  <span class="tag">3 unlocked</span>
                </div>
                <div class="mini muted" style="line-height:1.55">
                  • 7-Day Streak<br/>
                  • First Raid Clear<br/>
                  • 10k Steps Day
                </div>
                <div class="mini muted" style="margin-top:10px; line-height:1.5">
                  Badges boost motivation by showing your wins.
                </div>
              </div>
            </div>

            <div class="sectionTitle" style="margin-top:14px">
              <h2>Quick Actions</h2>
              <span>One tap</span>
            </div>

            <div class="grid">
              <div class="card" style="padding:12px">
                <div class="mini muted"><b style="color:rgba(255,255,255,.92)">Record Workout</b></div>
                <div class="mini muted" style="margin-top:6px; line-height:1.4">
                  Log a session to earn XP + tokens instantly.
                </div>
                <div class="btnRow">
                  <button class="btn primary" onclick="openRecord('Run/Walk')">Record</button>
                  <button class="btn" onclick="toast('Streak info (demo).')">Streak</button>
                </div>
              </div>

              <div class="card" style="padding:12px">
                <div class="mini muted"><b style="color:rgba(255,255,255,.92)">Rank Push</b></div>
                <div class="mini muted" style="margin-top:6px; line-height:1.4">
                  Hit 60 minutes today to unlock boss gate rewards.
                </div>
                <div class="btnRow">
                  <button class="btn" onclick="addMinutes(10)">+10 min</button>
                  <button class="btn pink" onclick="addMinutes(20)">+20 min</button>
                </div>
              </div>
            </div>
          </section>
        </div>

        <!-- Bottom nav -->
        <div class="nav" aria-label="Bottom navigation">
          <button class="active" data-go="map" title="Map"><span class="ico"></span>Map</button>
          <button data-go="train" title="Train"><span class="ico"></span>Train</button>
          <button data-go="build" title="Build"><span class="ico"></span>Build</button>
          <button data-go="leaderboard" title="Leaderboard"><span class="ico"></span>Rank</button>
          <button data-go="vault" title="Vault"><span class="ico"></span>Vault</button>
        </div>

        <!-- SUMMON MODAL -->
        <div class="backdrop" id="summonBack" role="dialog" aria-modal="true">
          <div class="modal">
            <div class="modalHead">
              <b>Summon Banner</b>
              <button class="btn ghost" id="closeSummon">Close</button>
            </div>
            <div class="modalBody">
              <div class="summonGrid">
                <div class="banner" id="bannerSkill">
                  <div class="bannerTitle">Shadow Skills</div>
                  <div class="bannerDesc">Abilities that boost training stats + gate damage.</div>
                  <div class="bannerFoot">
                    <div class="rarRow">
                      <span class="rarDot common"></span>
                      <span class="rarDot rare"></span>
                      <span class="rarDot epic"></span>
                      <span class="rarDot"></span>
                      <span class="rarLabel">Common → Legendary</span>
                    </div>
                    <span class="tag">Cost: 1</span>
                  </div>
                </div>

                <div class="banner" id="bannerCosmetic">
                  <div class="bannerTitle">Neon Cosmetics</div>
                  <div class="bannerDesc">Cloaks, auras, titles (looks only).</div>
                  <div class="bannerFoot">
                    <div class="rarRow">
                      <span class="rarDot common"></span>
                      <span class="rarDot rare"></span>
                      <span class="rarDot epic"></span>
                      <span class="rarDot"></span>
                      <span class="rarLabel">Style drops</span>
                    </div>
                    <span class="tag">Cost: 1</span>
                  </div>
                </div>
              </div>

              <div class="summonStage" id="summonStage">
                <div class="summonPrompt">
                  <div class="mini muted" style="max-width:70%">
                    <b style="color:rgba(255,255,255,.92)">Tokens:</b> <span class="mono" id="tokensModal">14</span><br/>
                    Roll the reel → land on an item.
                  </div>
                  <span class="tag" id="activeBannerTag">Selected: Shadow Skills</span>
                </div>

                <div class="reelWrap">
                  <div class="reelViewport" aria-label="Summon reel">
                    <div class="reelIndicator"></div>
                    <div class="reel" id="reel"></div>
                  </div>

                  <div class="summonBtnBar">
                    <button class="btn" id="btnSummon1">Roll x1</button>
                    <button class="btn pink" id="btnSummon3">Roll x3</button>
                  </div>
                </div>
              </div>

              <div class="summonResult" id="summonResult">
                <div class="resultName" id="resultName">—</div>
                <div class="resultMeta" id="resultMeta">—</div>
                <div class="resultBadgeRow" id="resultBadges"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- RECORD MODAL -->
        <div class="backdrop" id="recordBack" role="dialog" aria-modal="true">
          <div class="modal">
            <div class="modalHead">
              <b>Record Workout</b>
              <button class="btn ghost" id="closeRecord">Close</button>
            </div>
            <div class="modalBody">
              <div class="form">
                <div class="field">
                  <div class="label">Exercise</div>
                  <input id="fExercise" placeholder="e.g., Push-ups" />
                </div>

                <div class="two">
                  <div class="field">
                    <div class="label">Type</div>
                    <select id="fType">
                      <option value="minutes">Minutes</option>
                      <option value="reps">Reps</option>
                      <option value="seconds">Seconds</option>
                    </select>
                  </div>
                  <div class="field">
                    <div class="label">Amount</div>
                    <input id="fAmount" type="number" min="1" placeholder="e.g., 20" />
                  </div>
                </div>

                <div class="two">
                  <div class="field">
                    <div class="label">Intensity</div>
                    <select id="fIntensity">
                      <option value="Easy">Easy</option>
                      <option value="Medium">Medium</option>
                      <option value="Hard">Hard</option>
                    </select>
                  </div>
                  <div class="field">
                    <div class="label">Notes</div>
                    <input id="fNotes" placeholder="optional (e.g., 3 sets)" />
                  </div>
                </div>

                <div class="btnRow">
                  <button class="btn" onclick="toast('Time: now (demo).')">Use Current Time</button>
                  <button class="btn primary" id="saveRecord">Save</button>
                </div>

                <div class="mini muted" style="line-height:1.45">
                  Demo tracker: entries saved to your browser.
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- DEMO CONTROLS (collapsible) -->
    <aside class="side" id="sidePanel" aria-label="Demo controls">
      <div class="sideHeader">
        <div>
          <h2>Demo Controls</h2>
          <div class="tiny">Hide this to view only the app.</div>
        </div>
        <button class="btn ghost" id="hideControlsBtn">Hide</button>
      </div>

      <div class="card" style="margin-bottom:10px">
        <div class="cardHeader">
          <div>
            <b>Quick Progress</b>
            <div class="mini muted">Simulate workouts</div>
          </div>
          <span class="tag">Demo</span>
        </div>

        <div class="mini muted" style="display:flex;justify-content:space-between">
          <span>Minutes Today</span>
          <span class="mono"><span id="ctlMinutes">34</span>/60</span>
        </div>
        <div class="btnRow">
          <button class="btn" onclick="addMinutes(5)">+5</button>
          <button class="btn" onclick="addMinutes(10)">+10</button>
          <button class="btn pink" onclick="addMinutes(20)">+20</button>
        </div>

        <div style="height:10px"></div>

        <div class="mini muted" style="display:flex;justify-content:space-between">
          <span>Tokens</span>
          <span class="mono" id="ctlTokens">14</span>
        </div>
        <div class="btnRow">
          <button class="btn" onclick="addTokens(1)">+1</button>
          <button class="btn" onclick="addTokens(5)">+5</button>
          <button class="btn primary" onclick="openSummon()">Summon</button>
        </div>
      </div>

      <div class="card">
        <div class="cardHeader">
          <div>
            <b>Shortcuts</b>
            <div class="mini muted">Keyboard</div>
          </div>
          <span class="tag mono">1–5</span>
        </div>
        <div class="mini muted" style="line-height:1.65">
          1 Map • 2 Train • 3 Build • 4 Rank • 5 Vault<br/>
          S Summon • ESC Close modals
        </div>
      </div>
    </aside>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    /* =========================
       STATE + STORAGE
       ========================= */
    const LS_KEY = "dungeonfit_demo_log_v2";
    const LS_STATE = "dungeonfit_demo_state_v2";

    const state = {
      minutesToday: 34,
      streak: 6,
      level: 12,
      hp: 86,
      sta: 42,
      tokens: 14,
      xp: 2840,
      xpNext: 3200,
      stats: { STR:14, AGI:19, END:16, LCK:8 },
      rank: "Silver",
      activeBanner: "skill",
      fx: "high",
      leaderboardMode: "steps", // steps | minutes | streak
      steps: 5240,
      squats: 32,
    };

    function loadState(){
      try{
        const raw = localStorage.getItem(LS_STATE);
        if(!raw) return;
        Object.assign(state, JSON.parse(raw));
      }catch(e){}
    }
    function saveState(){
      try{ localStorage.setItem(LS_STATE, JSON.stringify(state)); }catch(e){}
    }

    function loadLog(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        return raw ? JSON.parse(raw) : [];
      }catch(e){ return []; }
    }
    function saveLog(entries){
      try{ localStorage.setItem(LS_KEY, JSON.stringify(entries)); }catch(e){}
    }

    /* =========================
       ELEMENTS
       ========================= */
    const views = {
      map: document.getElementById("view-map"),
      train: document.getElementById("view-train"),
      build: document.getElementById("view-build"),
      leaderboard: document.getElementById("view-leaderboard"),
      vault: document.getElementById("view-vault"),
    };
    const navButtons = Array.from(document.querySelectorAll(".nav button"));

    const el = {
      streak: document.getElementById("streak"),
      lvl: document.getElementById("lvl"),
      hp: document.getElementById("hp"),
      sta: document.getElementById("sta"),
      rank: document.getElementById("rank"),
      mins: document.getElementById("mins"),
      dailyBar: document.getElementById("dailyBar"),
      goalPct: document.getElementById("goalPct"),
      steps: document.getElementById("steps"),
      squatsDone: document.getElementById("squatsDone"),
      barSquats: document.getElementById("barSquats"),
      sumMinutes: document.getElementById("sumMinutes"),
      sumReps: document.getElementById("sumReps"),
      history: document.getElementById("history"),

      tokens: document.getElementById("tokens"),
      tokensModal: document.getElementById("tokensModal"),
      ctlMinutes: document.getElementById("ctlMinutes"),
      ctlTokens: document.getElementById("ctlTokens"),

      xpNow: document.getElementById("xpNow"),
      xpNext: document.getElementById("xpNext"),
      lvlNext: document.getElementById("lvlNext"),
      statSTR: document.getElementById("statSTR"),
      statAGI: document.getElementById("statAGI"),
      statEND: document.getElementById("statEND"),
      statLCK: document.getElementById("statLCK"),

      openSummon: document.getElementById("openSummon"),
      summonBack: document.getElementById("summonBack"),
      closeSummon: document.getElementById("closeSummon"),
      bannerSkill: document.getElementById("bannerSkill"),
      bannerCosmetic: document.getElementById("bannerCosmetic"),
      activeBannerTag: document.getElementById("activeBannerTag"),
      btnSummon1: document.getElementById("btnSummon1"),
      btnSummon3: document.getElementById("btnSummon3"),
      reel: document.getElementById("reel"),
      summonResult: document.getElementById("summonResult"),
      resultName: document.getElementById("resultName"),
      resultMeta: document.getElementById("resultMeta"),
      resultBadges: document.getElementById("resultBadges"),

      recordBack: document.getElementById("recordBack"),
      closeRecord: document.getElementById("closeRecord"),
      saveRecord: document.getElementById("saveRecord"),
      fExercise: document.getElementById("fExercise"),
      fType: document.getElementById("fType"),
      fAmount: document.getElementById("fAmount"),
      fIntensity: document.getElementById("fIntensity"),
      fNotes: document.getElementById("fNotes"),

      map: document.getElementById("map"),

      toast: document.getElementById("toast"),

      lbList: document.getElementById("lbList"),
      tabSteps: document.getElementById("tabSteps"),
      tabMinutes: document.getElementById("tabMinutes"),
      tabStreak: document.getElementById("tabStreak"),

      sidePanel: document.getElementById("sidePanel"),
      hideControlsBtn: document.getElementById("hideControlsBtn"),
      showControlsBtn: document.getElementById("showControlsBtn"),
    };

    /* =========================
       HELPERS
       ========================= */
    const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));
    const fmt = (n)=>new Intl.NumberFormat().format(n);
    const sleep = (ms)=>new Promise(r=>setTimeout(r,ms));

    function toast(msg){
      el.toast.textContent = msg;
      el.toast.style.opacity = "1";
      clearTimeout(toast._t);
      toast._t = setTimeout(()=> el.toast.style.opacity = "0", 2200);
    }

    function escapeHTML(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;");
    }

    /* =========================
       VIEW SWITCH
       ========================= */
    function showView(key){
      Object.values(views).forEach(v=>v.classList.remove("active"));
      (views[key] || views.map).classList.add("active");
      navButtons.forEach(b=>b.classList.remove("active"));
      const btn = navButtons.find(b=>b.dataset.go===key);
      if(btn) btn.classList.add("active");

      const view = views[key] || views.map;
      const cards = Array.from(view.querySelectorAll(".card, .map"));
      cards.forEach((c,i)=>{
        c.animate(
          [{ opacity: 0, transform: "translateY(10px) scale(.99)" },
           { opacity: 1, transform: "translateY(0) scale(1)" }],
          { duration: 240 + i*18, easing: "cubic-bezier(.2,.8,.2,1)", fill: "both" }
        );
      });
    }
    navButtons.forEach(btn=>btn.addEventListener("click", ()=>showView(btn.dataset.go)));

    /* =========================
       EXERCISE "PICTURES" (INLINE SVG)
       ========================= */
    function mountSVG(targetId, type){
      const target = document.getElementById(targetId);
      const css = getComputedStyle(document.documentElement);
      const A = css.getPropertyValue("--neonA").trim();
      const B = css.getPropertyValue("--neonB").trim();
      const C = css.getPropertyValue("--neonC").trim();
      const D = css.getPropertyValue("--neonD").trim();

      const svgs = {
        pushup: `
          <svg viewBox="0 0 64 64" fill="none">
            <defs><linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
              <stop stop-color="${A}"/><stop offset="1" stop-color="${B}"/></linearGradient></defs>
            <path d="M8 44c6-6 14-10 24-10s18 4 24 10" stroke="url(#g1)" stroke-width="3" stroke-linecap="round"/>
            <path d="M18 38l8-8h18l6 6" stroke="rgba(255,255,255,.86)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="24" cy="28" r="4" fill="rgba(255,255,255,.86)"/>
            <path d="M10 48h44" stroke="rgba(255,255,255,.22)" stroke-width="3" stroke-linecap="round"/>
          </svg>`,
        squat: `
          <svg viewBox="0 0 64 64" fill="none">
            <path d="M14 48h36" stroke="rgba(255,255,255,.22)" stroke-width="3" stroke-linecap="round"/>
            <path d="M20 18c3 2 6 3 12 3s10-1 12-3" stroke="rgba(255,255,255,.74)" stroke-width="3" stroke-linecap="round"/>
            <path d="M26 24l-6 10 8 6 8-6 8 6 8-6-6-10" stroke="rgba(255,255,255,.86)" stroke-width="3" stroke-linejoin="round"/>
            <path d="M22 34h20" stroke="${D}" stroke-width="3" stroke-linecap="round"/>
            <circle cx="32" cy="14" r="4" fill="${B}"/>
          </svg>`,
        run: `
          <svg viewBox="0 0 64 64" fill="none">
            <path d="M10 48h44" stroke="rgba(255,255,255,.22)" stroke-width="3" stroke-linecap="round"/>
            <circle cx="36" cy="14" r="4" fill="${A}"/>
            <path d="M34 20l-8 10 10 4 6-8 8 4" stroke="rgba(255,255,255,.86)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18 44l10-8 8 2-4 10" stroke="rgba(255,255,255,.74)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M40 44l8-6" stroke="${B}" stroke-width="3" stroke-linecap="round"/>
            <path d="M12 30c4 0 6-2 10-6" stroke="rgba(0,229,255,.30)" stroke-width="3" stroke-linecap="round"/>
          </svg>`,
        plank: `
          <svg viewBox="0 0 64 64" fill="none">
            <path d="M10 48h44" stroke="rgba(255,255,255,.22)" stroke-width="3" stroke-linecap="round"/>
            <path d="M16 36h32" stroke="rgba(255,255,255,.82)" stroke-width="6" stroke-linecap="round"/>
            <circle cx="18" cy="30" r="4" fill="${B}"/>
            <path d="M22 36l-8 8" stroke="rgba(255,255,255,.72)" stroke-width="3" stroke-linecap="round"/>
            <path d="M42 36l8 8" stroke="rgba(255,255,255,.72)" stroke-width="3" stroke-linecap="round"/>
            <path d="M28 28h12" stroke="${A}" stroke-width="3" stroke-linecap="round"/>
          </svg>`,
      };
      target.innerHTML = svgs[type] || "";
    }
    mountSVG("img-pushup","pushup");
    mountSVG("img-squat","squat");
    mountSVG("img-run","run");
    mountSVG("img-plank","plank");

    /* =========================
       UI UPDATE
       ========================= */
    function updateUI(){
      el.streak.textContent = state.streak;
      el.lvl.textContent = state.level;
      el.hp.textContent = state.hp;
      el.sta.textContent = state.sta;
      el.rank.textContent = state.rank;

      el.mins.textContent = Math.round(state.minutesToday);
      el.sumMinutes.textContent = Math.round(state.minutesToday);

      el.tokens.textContent = state.tokens;
      el.tokensModal.textContent = state.tokens;

      el.ctlMinutes.textContent = Math.round(state.minutesToday);
      el.ctlTokens.textContent = state.tokens;

      el.steps.textContent = fmt(state.steps);
      el.squatsDone.textContent = String(state.squats);

      const sqPct = clamp(Math.round((state.squats/50)*100),0,100);
      el.barSquats.style.width = sqPct + "%";

      el.xpNow.textContent = fmt(state.xp);
      el.xpNext.textContent = fmt(state.xpNext);
      el.lvlNext.textContent = state.level + 1;

      el.statSTR.textContent = state.stats.STR;
      el.statAGI.textContent = state.stats.AGI;
      el.statEND.textContent = state.stats.END;
      el.statLCK.textContent = state.stats.LCK;

      const pct = clamp(Math.round((state.minutesToday/60)*100),0,100);
      el.goalPct.textContent = pct;
      el.dailyBar.style.width = pct + "%";

      const boss = el.map.querySelector(".node.boss");
      if(state.minutesToday >= 60) boss.classList.remove("locked");
      else boss.classList.add("locked");

      renderLeaderboard();
      saveState();
    }

    /* =========================
       MAP NODE PREVIEW
       ========================= */
    el.map.addEventListener("click", (e)=>{
      const node = e.target.closest(".node");
      if(!node) return;
      const name = node.dataset.node;
      const diff = node.dataset.diff;
      const req = node.dataset.req;
      const reward = node.dataset.reward;

      node.animate(
        [
          { transform:"translateY(0) scale(1)" },
          { transform:"translateY(-2px) scale(1.06)" },
          { transform:"translateY(0) scale(1)" }
        ],
        { duration: 280, easing: "cubic-bezier(.2,.8,.2,1)" }
      );

      toast(`${name} • ${diff}\nReq: ${req}\nReward: ${reward}`);
    });

    /* =========================
       WORKOUT LOG / TRACKER
       ========================= */
    let log = [];
    function computeSummary(){
      let reps = 0;
      for(const e of log){
        if(e.type === "reps") reps += Number(e.amount||0);
      }
      el.sumReps.textContent = reps;
    }

    function renderHistory(){
      el.history.innerHTML = "";
      if(log.length === 0){
        const empty = document.createElement("div");
        empty.className = "entry";
        empty.innerHTML = `
          <div class="entryTop">
            <div>
              <div class="entryTitle">No workouts logged yet</div>
              <div class="entryMeta">Tap “Record” to add an entry.</div>
            </div>
          </div>`;
        el.history.appendChild(empty);
        return;
      }

      const sorted = [...log].sort((a,b)=>b.t - a.t).slice(0,12);
      for(const item of sorted){
        const d = new Date(item.t);
        const time = d.toLocaleString(undefined,{month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"});
        const div = document.createElement("div");
        div.className = "entry";
        div.innerHTML = `
          <div class="entryTop">
            <div>
              <div class="entryTitle">${escapeHTML(item.exercise)} <span class="tag" style="margin-left:6px">${escapeHTML(item.intensity)}</span></div>
              <div class="entryMeta">
                ${escapeHTML(item.type)}: <span class="mono">${escapeHTML(String(item.amount))}</span>
                • ${time}
                ${item.notes ? `• ${escapeHTML(item.notes)}` : ""}
              </div>
            </div>
            <div class="entryActions">
              <button class="tinyBtn danger" data-del="${item.id}">Delete</button>
            </div>
          </div>`;
        el.history.appendChild(div);
      }

      el.history.querySelectorAll("[data-del]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-del");
          log = log.filter(x=>x.id !== id);
          saveLog(log);
          computeSummary();
          renderHistory();
          toast("Entry deleted.");
        });
      });
    }

    function openRecord(exName){
      el.fExercise.value = exName || "";
      el.fType.value = "reps";
      el.fAmount.value = "";
      el.fIntensity.value = "Medium";
      el.fNotes.value = "";
      el.recordBack.classList.add("show");
      document.querySelector("#recordBack .modal").animate(
        [{transform:"translateY(10px) scale(.98)", opacity:0},{transform:"translateY(0) scale(1)", opacity:1}],
        {duration:200, easing:"cubic-bezier(.2,.8,.2,1)", fill:"both"}
      );
    }
    function preset(ex, type, amt){
      openRecord(ex);
      el.fType.value = type;
      el.fAmount.value = amt;
      toast(`Preset: ${ex}`);
    }

    el.closeRecord.addEventListener("click", ()=> el.recordBack.classList.remove("show"));
    el.recordBack.addEventListener("click", (e)=>{ if(e.target===el.recordBack) el.recordBack.classList.remove("show"); });

    el.saveRecord.addEventListener("click", ()=>{
      const exercise = (el.fExercise.value || "").trim();
      const type = el.fType.value;
      const amount = Number(el.fAmount.value || 0);
      const intensity = el.fIntensity.value;
      const notes = (el.fNotes.value || "").trim();

      if(!exercise || !amount || amount <= 0){
        toast("Enter exercise + amount.");
        return;
      }

      const entry = {
        id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()) + Math.random(),
        t: Date.now(),
        exercise, type, amount,
        intensity, notes
      };
      log.push(entry);
      saveLog(log);

      applyEntryToState(entry);

      computeSummary();
      renderHistory();
      el.recordBack.classList.remove("show");
      toast("Workout logged.\nRewards granted.");
    });

    function applyEntryToState(entry){
      const a = Number(entry.amount||0);
      const lowName = (entry.exercise||"").toLowerCase();

      // minutes
      if(entry.type === "minutes"){
        state.minutesToday = clamp(state.minutesToday + a, 0, 240);
        if(lowName.includes("run") || lowName.includes("walk")) state.steps += Math.round(a * 220);
      }
      if(entry.type === "seconds"){
        state.minutesToday = clamp(state.minutesToday + (a/60), 0, 240);
      }

      // reps
      if(entry.type === "reps"){
        if(lowName.includes("squat")) state.squats += a;
      }

      // stats
      const mult = entry.intensity === "Hard" ? 1.35 : entry.intensity === "Medium" ? 1.0 : 0.8;
      const xpGain = Math.round((entry.type === "reps" ? a*4 : entry.type === "seconds" ? (a/2) : a*18) * mult);
      const tokenGain = entry.intensity === "Hard" ? 2 : 1;

      state.xp += xpGain;
      state.tokens = clamp(state.tokens + tokenGain, 0, 999);

      if(entry.type === "reps") state.stats.STR += (a >= 25 ? 1 : 0);
      if(entry.type === "minutes") state.stats.END += (a >= 20 ? 1 : 0);
      if(lowName.includes("run") || lowName.includes("walk")) state.stats.AGI += 1;

      // level up loop
      while(state.xp >= state.xpNext){
        state.level += 1;
        state.xp -= state.xpNext;
        state.xpNext = Math.round(state.xpNext * 1.14);
        state.stats.END += 1;
        state.stats.LCK += 1;
        toast("LEVEL UP!\nNew gates unlocked (demo).");
        shakePhone(8);
      }

      // stamina/hp vibes
      state.sta = clamp(state.sta + Math.round(a/4), 0, 60);
      state.hp = clamp(state.hp + Math.round(a/6), 0, 100);

      // rank vibe
      if(state.level >= 15) state.rank = "Gold";
      if(state.level >= 22) state.rank = "Platinum";

      updateUI();
    }

    function exportLog(){
      const data = JSON.stringify(log, null, 2);
      navigator.clipboard?.writeText(data).then(()=> toast("Log copied (JSON).")).catch(()=> toast("Copy blocked."));
    }
    function clearLog(){
      if(!confirm("Clear all recorded workouts?")) return;
      log = [];
      saveLog(log);
      renderHistory();
      computeSummary();
      toast("Log cleared.");
    }

    /* =========================
       DEMO BUTTONS (minutes/tokens)
       ========================= */
    function addMinutes(n){
      state.minutesToday = clamp(state.minutesToday + n, 0, 240);
      state.steps += n * 200;
      state.xp += n * 25;
      state.tokens = clamp(state.tokens + Math.max(1, Math.round(n/10)), 0, 999);

      while(state.xp >= state.xpNext){
        state.level += 1;
        state.xp -= state.xpNext;
        state.xpNext = Math.round(state.xpNext * 1.14);
        state.stats.END += 1;
        toast("LEVEL UP!");
      }
      updateUI();
      if(state.minutesToday >= 60) toast("Daily goal hit.\nBoss gate unlocked.");
      else toast(`+${n} minutes.`);
    }
    function addTokens(n){
      state.tokens = clamp(state.tokens + n, 0, 999);
      updateUI();
      toast(`+${n} token(s).`);
    }
    window.addMinutes = addMinutes;
    window.addTokens = addTokens;
    window.openRecord = openRecord;
    window.preset = preset;
    window.exportLog = exportLog;
    window.clearLog = clearLog;

    /* =========================
       SUMMON: REEL ROLL (LEFT → RIGHT)
       ========================= */
    const lootTables = {
      skill: {
        common: ["Sprint +1","Iron Core +1","Focus +1","Stamina Surge +1","Tempo +1","Shield +1"],
        rare: ["Shadow Step","Critical Tempo","Endurance Sigil","Gate Sense","Dash Cancel"],
        epic: ["Monarch's Pulse","Abyssal Stride","Gatebreaker Aura","Void Tempo"],
        legendary: ["Shadow Monarch's Blessing"]
      },
      cosmetic: {
        common: ["Training Band","Runner Visor","Blue Glow","Sticker Pack","Neon Trail"],
        rare: ["Neon Cloak","Cyan Trail","Silver Title: Runner","Pink Aura"],
        epic: ["Violet Monarch Cloak","Abyss Crown","Title: Gatebreaker","Laser Aura"],
        legendary: ["Monarch Aura: Eternal Night"]
      }
    };

    function rollRarity(){
      // common 72%, rare 20%, epic 7%, legendary 1%
      const r = Math.random();
      if(r < 0.01) return "legendary";
      if(r < 0.08) return "epic";
      if(r < 0.28) return "rare";
      return "common";
    }

    function pickLoot(banner, rarity){
      const arr = lootTables[banner][rarity];
      const name = arr[Math.floor(Math.random()*arr.length)];
      const type = banner === "skill" ? "Skill" : "Cosmetic";
      return { name, type, rarity };
    }

    // Build reel candidates (flatten table)
    function buildReelCandidates(banner){
      const out = [];
      const tbl = lootTables[banner];
      for(const rar of ["common","rare","epic","legendary"]){
        for(const nm of tbl[rar]){
          out.push({ name:nm, type: banner==="skill" ? "Skill" : "Cosmetic", rarity: rar });
        }
      }
      return out;
    }

    let reelCandidates = [];
    let reelSpinning = false;

    function rarityClass(r){
      if(r==="legendary") return "rar-legendary";
      if(r==="epic") return "rar-epic";
      if(r==="rare") return "rar-rare";
      return "rar-common";
    }

    function renderReel(banner){
      reelCandidates = buildReelCandidates(banner);
      // Duplicate candidates to make the reel long enough to spin smoothly
      const pool = [];
      for(let i=0;i<7;i++){
        pool.push(...reelCandidates);
      }
      el.reel.innerHTML = pool.map(item=>`
        <div class="reelItem" data-name="${escapeHTML(item.name)}" data-type="${escapeHTML(item.type)}" data-rarity="${item.rarity}">
          <div class="reelLeft">
            <div class="reelIcon"></div>
            <div style="min-width:0">
              <div class="reelName">${escapeHTML(item.name)}</div>
              <div class="reelType">${escapeHTML(item.type)}</div>
            </div>
          </div>
          <div class="reelRarity ${rarityClass(item.rarity)}">${item.rarity.toUpperCase()}</div>
        </div>
      `).join("");

      // reset transform
      el.reel.style.transform = "translateX(0px)";
    }

    function setBanner(kind){
      state.activeBanner = kind;
      el.activeBannerTag.textContent = kind === "skill" ? "Selected: Shadow Skills" : "Selected: Neon Cosmetics";

      el.bannerSkill.classList.toggle("sel", kind==="skill");
      el.bannerCosmetic.classList.toggle("sel", kind==="cosmetic");

      renderReel(kind);
      saveState();
    }

    async function openSummon(){
      el.summonBack.classList.add("show");
      document.querySelector("#summonBack .modal").animate(
        [{transform:"translateY(10px) scale(.98)", opacity:0},{transform:"translateY(0) scale(1)", opacity:1}],
        {duration:200, easing:"cubic-bezier(.2,.8,.2,1)", fill:"both"}
      );
      el.summonResult.classList.remove("show");
      setBanner(state.activeBanner || "skill");
      updateUI();
    }

    el.openSummon.addEventListener("click", openSummon);
    el.closeSummon.addEventListener("click", ()=> el.summonBack.classList.remove("show"));
    el.summonBack.addEventListener("click", (e)=>{ if(e.target===el.summonBack) el.summonBack.classList.remove("show"); });

    el.bannerSkill.addEventListener("click", ()=> setBanner("skill"));
    el.bannerCosmetic.addEventListener("click", ()=> setBanner("cosmetic"));

    async function rollOnce(){
      if(reelSpinning) return;
      if(state.tokens < 1){
        toast("Not enough tokens.");
        return;
      }

      reelSpinning = true;
      state.tokens -= 1;
      updateUI();
      el.summonResult.classList.remove("show");

      // choose final prize
      const rarity = rollRarity();
      const prize = pickLoot(state.activeBanner, rarity);

      // Build a long reel and force a stop near the center
      // We'll pick a random index near the end to land on prize
      const items = Array.from(el.reel.children);
      // find a future index that matches the prize name (so it visibly lands on it)
      const matches = items
        .map((node, idx)=>({node, idx}))
        .filter(x => x.node.getAttribute("data-name") === prize.name);

      const target = matches.length ? matches[Math.floor(Math.random()*matches.length)] : { idx: items.length - 10 };
      const viewport = el.reel.parentElement.getBoundingClientRect();
      const targetRect = items[target.idx].getBoundingClientRect();

      // We need to compute distance to move reel so that target item center aligns with viewport center.
      // Because transforms affect bounding boxes, we compute using element widths:
      const reelPaddingLeft = 12;  // from CSS
      const itemW = items[0].getBoundingClientRect().width;
      const gap = 10;
      const step = itemW + gap;

      // target item's center position in reel coordinates:
      const targetCenter = reelPaddingLeft + (target.idx * step) + (itemW/2);
      const viewportCenter = viewport.width / 2;

      // we want translateX = viewportCenter - targetCenter
      // but we also want a long spin feel: add extra full cycles
      const extra = step * (reelCandidates.length * 2); // extra travel
      const finalX = (viewportCenter - targetCenter) - extra;

      // animate fast -> slow
      const startX = getCurrentTranslateX(el.reel);
      const keyframes = [
        { transform: `translateX(${startX}px)` },
        { transform: `translateX(${finalX}px)` }
      ];

      // reel glow pulse
      el.reel.parentElement.animate(
        [{filter:"brightness(1) saturate(1)"},{filter:"brightness(1.14) saturate(1.2)"},{filter:"brightness(1) saturate(1)"}],
        {duration: 900, easing:"cubic-bezier(.2,.8,.2,1)"}
      );

      const anim = el.reel.animate(keyframes, {
        duration: 1600,
        easing: "cubic-bezier(.12,.78,.12,1)",
        fill:"forwards"
      });

      await anim.finished.catch(()=>{});
      el.reel.style.transform = `translateX(${finalX}px)`; // lock final

      // show result
      showSummonResult(prize);

      // rewards vibe
      const xpBonus = prize.rarity === "legendary" ? 600 : prize.rarity === "epic" ? 360 : prize.rarity === "rare" ? 220 : 140;
      state.xp += xpBonus;
      if(prize.rarity === "legendary"){ shakePhone(10); toast("LEGENDARY DROP!"); }
      else if(prize.rarity === "epic"){ toast("EPIC drop!"); }
      else if(prize.rarity === "rare"){ toast("RARE drop!"); }
      else { toast("Drop acquired."); }

      // small stat bump (demo)
      if(state.activeBanner==="skill"){
        if(prize.rarity==="rare") state.stats.AGI += 1;
        if(prize.rarity==="epic") state.stats.END += 1;
        if(prize.rarity==="legendary") state.stats.LCK += 2;
      }

      // level up
      while(state.xp >= state.xpNext){
        state.level += 1;
        state.xp -= state.xpNext;
        state.xpNext = Math.round(state.xpNext * 1.14);
        state.stats.END += 1;
        state.stats.LCK += 1;
      }

      updateUI();
      reelSpinning = false;
    }

    async function rollMany(n){
      for(let i=0;i<n;i++){
        if(state.tokens < 1) break;
        await rollOnce();
        await sleep(250);
      }
    }

    function showSummonResult(prize){
      el.summonResult.classList.add("show");
      el.resultName.textContent = `${prize.rarity.toUpperCase()} • ${prize.name}`;
      el.resultMeta.textContent = `Type: ${prize.type} • Banner: ${state.activeBanner === "skill" ? "Shadow Skills" : "Neon Cosmetics"}`;

      el.resultBadges.innerHTML = "";
      const chips = [];

      chips.push({label:"+XP Bonus", style:"background:rgba(0,229,255,.10);border-color:rgba(0,229,255,.22)"});
      if(prize.rarity==="rare") chips.push({label:"Boost", style:"background:rgba(0,229,255,.08);border-color:rgba(0,229,255,.22)"});
      if(prize.rarity==="epic") chips.push({label:"Big Boost", style:"background:rgba(124,77,255,.10);border-color:rgba(124,77,255,.22)"});
      if(prize.rarity==="legendary") chips.push({label:"Ultra Boost", style:"background:rgba(255,204,0,.10);border-color:rgba(255,204,0,.22)"});

      for(const c of chips){
        const span = document.createElement("span");
        span.className = "tag";
        span.style.cssText = c.style;
        span.textContent = c.label;
        el.resultBadges.appendChild(span);
      }

      el.summonResult.animate(
        [{opacity:0, transform:"translateY(8px)"},{opacity:1, transform:"translateY(0)"}],
        {duration:220, easing:"cubic-bezier(.2,.8,.2,1)", fill:"both"}
      );
    }

    function getCurrentTranslateX(node){
      const st = getComputedStyle(node);
      const tr = st.transform;
      if(!tr || tr==="none") return 0;
      const m = tr.match(/matrix\(([^)]+)\)/);
      if(!m) return 0;
      const parts = m[1].split(",").map(x=>Number(x.trim()));
      return parts.length >= 6 ? parts[4] : 0;
    }

    el.btnSummon1.addEventListener("click", ()=>rollMany(1));
    el.btnSummon3.addEventListener("click", ()=>rollMany(3));

    /* =========================
       LEADERBOARD (NEW)
       ========================= */
    const baseLB = [
      {name:"Kai", clan:"Shadow Clan", steps: 8420, minutes: 52, streak: 7},
      {name:"Zain", clan:"Neon Guild", steps: 7840, minutes: 46, streak: 5},
      {name:"Mina", clan:"Gatebreakers", steps: 7320, minutes: 44, streak: 6},
      {name:"Ari", clan:"Stride Squad", steps: 6900, minutes: 41, streak: 4},
      {name:"Jules", clan:"Solo Runners", steps: 6500, minutes: 38, streak: 3},
    ];

    function getLeaderboard(){
      // include "You"
      const you = {name:"You", clan:"Your Squad", steps: state.steps, minutes: Math.round(state.minutesToday), streak: state.streak};

      // merge and sort by mode
      const list = [you, ...baseLB.map(x=>({...x}))];

      const mode = state.leaderboardMode;
      list.sort((a,b)=> (b[mode] - a[mode]));

      // ensure unique name sorting stable
      return list.map((x,i)=>({...x, rank:i+1}));
    }

    function renderLeaderboard(){
      if(!el.lbList) return;
      const mode = state.leaderboardMode;

      const rows = getLeaderboard().slice(0,6);
      el.lbList.innerHTML = rows.map(r=>{
        const score = mode === "steps" ? `${fmt(r.steps)}`
                    : mode === "minutes" ? `${r.minutes}`
                    : `${r.streak}`;
        const label = mode === "steps" ? "steps"
                    : mode === "minutes" ? "min"
                    : "streak";

        const glow = r.rank===1 ? "lbGlowTop1" : r.rank===2 ? "lbGlowTop2" : r.rank===3 ? "lbGlowTop3" : "";
        return `
          <div class="lbRow ${glow}">
            <div class="rankNum">${r.rank}</div>
            <div class="lbUser">
              <div class="pfp"></div>
              <div style="min-width:0">
                <div class="lbName">${escapeHTML(r.name)}</div>
                <div class="lbSub">${escapeHTML(r.clan)}</div>
              </div>
            </div>
            <div class="lbScore">${score} <span style="opacity:.7"> ${label}</span></div>
          </div>
        `;
      }).join("");
    }

    function setLBMode(mode){
      state.leaderboardMode = mode;
      el.tabSteps.classList.toggle("active", mode==="steps");
      el.tabMinutes.classList.toggle("active", mode==="minutes");
      el.tabStreak.classList.toggle("active", mode==="streak");
      renderLeaderboard();
      saveState();
    }

    el.tabSteps.addEventListener("click", ()=>setLBMode("steps"));
    el.tabMinutes.addEventListener("click", ()=>setLBMode("minutes"));
    el.tabStreak.addEventListener("click", ()=>setLBMode("streak"));

    /* =========================
       CONTROLS: HIDE / SHOW
       ========================= */
    function hideControls(){
      el.sidePanel.classList.add("sideCollapsed");
      el.showControlsBtn.classList.add("show");
      toast("Controls hidden.");
    }
    function showControls(){
      el.sidePanel.classList.remove("sideCollapsed");
      el.showControlsBtn.classList.remove("show");
      toast("Controls shown.");
    }
    el.hideControlsBtn.addEventListener("click", hideControls);
    el.showControlsBtn.addEventListener("click", showControls);

    /* =========================
       PHONE SHAKE
       ========================= */
    function shakePhone(intensity=6){
      const phone = document.querySelector(".phone");
      phone.animate(
        [
          { transform:"translateX(0px) translateY(0px)" },
          { transform:`translateX(${intensity}px) translateY(-2px)` },
          { transform:`translateX(-${intensity}px) translateY(2px)` },
          { transform:`translateX(${intensity*.6}px) translateY(-1px)` },
          { transform:"translateX(0px) translateY(0px)" }
        ],
        { duration: 220, easing:"cubic-bezier(.2,.8,.2,1)" }
      );
    }

    /* =========================
       BACKGROUND PARTICLES
       ========================= */
    let dustCtx, dustW, dustH, dustParticles=[], dustAnim=null;

    function initDust(){
      const c = document.getElementById("dust");
      dustCtx = c.getContext("2d");
      resizeDust();

      dustParticles = [];
      const count = 120;
      for(let i=0;i<count;i++){
        dustParticles.push({
          x: Math.random()*dustW,
          y: Math.random()*dustH,
          r: Math.random()*1.8 + 0.6,
          a: Math.random()*0.34 + 0.10,
          vx: (Math.random() - 0.5) * 0.20,
          vy: (Math.random() - 0.5) * 0.14,
          hue: Math.random()
        });
      }
      if(dustAnim) cancelAnimationFrame(dustAnim);
      loopDust();
    }

    function resizeDust(){
      const c = document.getElementById("dust");
      const rect = c.getBoundingClientRect();
      dustW = c.width = Math.floor(rect.width * devicePixelRatio);
      dustH = c.height = Math.floor(rect.height * devicePixelRatio);
    }

    function loopDust(){
      dustCtx.clearRect(0,0,dustW,dustH);
      for(const p of dustParticles){
        p.x += p.vx * devicePixelRatio;
        p.y += p.vy * devicePixelRatio;

        if(p.x < -60) p.x = dustW + 60;
        if(p.x > dustW + 60) p.x = -60;
        if(p.y < -60) p.y = dustH + 60;
        if(p.y > dustH + 60) p.y = -60;

        // neon color blend
        const col = p.hue < 0.34 ? "124,77,255" : p.hue < 0.67 ? "0,229,255" : "255,43,214";
        const g = dustCtx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*7);
        g.addColorStop(0, `rgba(${col},${p.a})`);
        g.addColorStop(1, `rgba(${col},0)`);
        dustCtx.fillStyle = g;
        dustCtx.beginPath();
        dustCtx.arc(p.x,p.y,p.r*7,0,Math.PI*2);
        dustCtx.fill();
      }
      dustAnim = requestAnimationFrame(loopDust);
    }

    window.addEventListener("resize", ()=>{ resizeDust(); initDust(); });

    /* =========================
       KEYBOARD SHORTCUTS
       ========================= */
    window.addEventListener("keydown", (e)=>{
      if(e.key === "1") showView("map");
      if(e.key === "2") showView("train");
      if(e.key === "3") showView("build");
      if(e.key === "4") showView("leaderboard");
      if(e.key === "5") showView("vault");
      if(e.key.toLowerCase() === "s") openSummon();
      if(e.key === "Escape"){
        el.summonBack.classList.remove("show");
        el.recordBack.classList.remove("show");
      }
    });

    /* =========================
       BOOT
       ========================= */
    loadState();
    log = loadLog();

    // Summon modal buttons
    el.bannerSkill.classList.add("sel");

    // Wire summon open/close + banners
    el.bannerSkill.addEventListener("click", ()=>setBanner("skill"));
    el.bannerCosmetic.addEventListener("click", ()=>setBanner("cosmetic"));

    // initial reel render
    renderReel(state.activeBanner || "skill");

    // record modal open function in global
    window.openSummon = openSummon;

    // init leaderboard tabs based on saved mode
    setLBMode(state.leaderboardMode || "steps");

    computeSummary();
    renderHistory();
    updateUI();
    initDust();

    setTimeout(()=>toast("Demo ready.\nTry Summon or Leaderboard."), 550);
  </script>
</body>
</html>
